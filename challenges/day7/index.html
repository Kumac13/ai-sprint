<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›½å¢ƒã«æŠ¼ã—å¯„ã›ã‚‹ç¾¤è¡†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #1a1a2e;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
      font-size: 24px;
      color: #fff;
    }
    #game-container {
      position: relative;
      margin: 20px 0;
    }
    canvas {
      border: 2px solid #444;
      background: linear-gradient(to right, #1e3a5f 0%, #2a5298 40%, #3d3d3d 70%, #2d2d2d 100%);
      cursor: crosshair;
    }
    #ui {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      width: 900px;
    }
    #stats {
      flex: 1;
      background: #16213e;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #0f3460;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 14px;
    }
    .stat-label { color: #aaa; }
    .stat-value {
      font-weight: bold;
      padding: 2px 8px;
      border-radius: 4px;
      background: #0f3460;
    }
    .stat-value.critical { background: #c62828; color: #fff; }
    .stat-value.good { background: #2e7d32; color: #fff; }
    #controls {
      flex: 1;
      background: #16213e;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #0f3460;
    }
    #instructions {
      background: #0f3460;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 10px;
      font-size: 14px;
      line-height: 1.6;
    }
    #instructions h3 {
      margin-bottom: 8px;
      color: #64b5f6;
    }
    #queue-count {
      text-align: center;
      margin: 10px 0;
      font-size: 14px;
      color: #ffa726;
    }
    #game-timer {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      padding: 20px 30px;
      border-radius: 12px;
      border: 3px solid #ffa726;
      z-index: 100;
    }
    #game-timer.warning {
      border-color: #ff6b6b;
      animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    #timer-display {
      font-size: 48px;
      font-weight: bold;
      color: #fff;
      text-align: center;
    }
    #timer-label {
      font-size: 14px;
      color: #aaa;
      text-align: center;
      margin-top: 5px;
    }
    .game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.95);
      padding: 40px;
      border-radius: 12px;
      border: 3px solid #c62828;
      text-align: center;
      z-index: 1000;
    }
    .game-over h2 {
      color: #ff6b6b;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="game-timer">
    <div id="timer-display">30</div>
    <div id="timer-label">æ®‹ã‚Šæ™‚é–“</div>
  </div>

  <h1>ğŸŒŠ å›½å¢ƒã«æŠ¼ã—å¯„ã›ã‚‹ç¾¤è¡†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ğŸš§</h1>
  <p>å·¦ã‹ã‚‰æµ·ã‚’æ¸¡ã£ã¦ããŸäººã€…ãŒæŠ¼ã—å¯„ã›ã¾ã™ã€‚å—ã‘å…¥ã‚Œã‚‹ã‹æ‹’å¦ã™ã‚‹ã‹åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚</p>

  <div id="game-container">
    <canvas id="canvas" width="900" height="500"></canvas>
  </div>

  <div id="ui">
    <div id="stats">
      <h3>å›½å®¶ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
      <div class="stat-row">
        <span class="stat-label">äººå£:</span>
        <span class="stat-value" id="population">100</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">è³‡æº:</span>
        <span class="stat-value" id="resources">100</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">å¹¸ç¦åº¦:</span>
        <span class="stat-value" id="happiness">70</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">å¤šæ§˜æ€§:</span>
        <span class="stat-value" id="diversity">30</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">çŠ¯ç½ªç‡:</span>
        <span class="stat-value" id="crime">10</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">å—å…¥äººæ•°:</span>
        <span class="stat-value" id="accepted">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">å›½å¢ƒæ»ç•™:</span>
        <span class="stat-value" id="atBorder">0</span>
      </div>
    </div>

    <div id="controls">
      <div id="queue-count">å¾…æ©Ÿä¸­: 0äºº</div>
      <div id="instructions">
        <h3>æ“ä½œæ–¹æ³•</h3>
        <p>ğŸ–±ï¸ <strong>å·¦ã‚¯ãƒªãƒƒã‚¯</strong>: æ¼‚æµè€…ã‚’å—ã‘å…¥ã‚Œã‚‹</p>
        <p>â³ <strong>ç„¡è¦–</strong>: å›½å¢ƒä»˜è¿‘ã«æ»ç•™</p>
        <p>ğŸ“Š å„æ¼‚æµè€…ã®æ¨ªã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŠ¹æœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
      </div>
    </div>
  </div>

  <script>
    // ============ æ¼‚æµè€…ãƒ‡ãƒ¼ã‚¿ï¼ˆ100äººä»¥ä¸Šï¼‰ ============
    const MIGRANT_TYPES = [
      // æŠ€èƒ½ç³»
      { name: 'Lian', trait: 'åŒ»å¸«', risk: 1, effect: { population: 3, resources: 5, crime: 0, happiness: 3, diversity: 2 } },
      { name: 'Kiro', trait: 'æŠ€è¡“è€…', effect: { population: 2, resources: 8, crime: 0, happiness: 1, diversity: 1 } },
      { name: 'Elena', trait: 'è¾²æ¥­æŠ€å¸«', effect: { population: 2, resources: 10, crime: 0, happiness: 2, diversity: 1 } },
      { name: 'Marcus', trait: 'å»ºç¯‰å£«', effect: { population: 2, resources: 6, crime: 0, happiness: 2, diversity: 1 } },
      { name: 'Sofia', trait: 'æ•™å¸«', effect: { population: 1, resources: -2, crime: 0, happiness: 5, diversity: 3 } },
      { name: 'Ahmed', trait: 'æ–™ç†äºº', effect: { population: 1, resources: 3, crime: 0, happiness: 4, diversity: 2 } },
      { name: 'Yuki', trait: 'çœ‹è­·å¸«', effect: { population: 2, resources: 3, crime: 0, happiness: 3, diversity: 2 } },
      { name: 'Ivan', trait: 'é›»æ°—æŠ€å¸«', effect: { population: 1, resources: 7, crime: 0, happiness: 1, diversity: 1 } },

      // æ–‡åŒ–ç³»
      { name: 'Mina', trait: 'è©©äºº', effect: { population: 1, resources: -2, crime: 0, happiness: 3, diversity: 5 } },
      { name: 'Raj', trait: 'éŸ³æ¥½å®¶', effect: { population: 1, resources: -1, crime: 0, happiness: 4, diversity: 4 } },
      { name: 'Zara', trait: 'ç”»å®¶', effect: { population: 1, resources: -1, crime: 0, happiness: 3, diversity: 5 } },
      { name: 'Omar', trait: 'å®—æ•™æŒ‡å°è€…', effect: { population: 1, resources: -3, crime: -2, happiness: 2, diversity: 6 } },
      { name: 'Chen', trait: 'å“²å­¦è€…', effect: { population: 1, resources: -2, crime: 0, happiness: 2, diversity: 4 } },

      // å®¶æ—ãƒ»å­ä¾›
      { name: 'Ravi', trait: 'å®¶æ—é€£ã‚Œ(5äºº)', effect: { population: 5, resources: -8, crime: 1, happiness: 3, diversity: 2 } },
      { name: 'Ana', trait: 'æ¯å­(2äºº)', effect: { population: 2, resources: -4, crime: 0, happiness: 2, diversity: 1 } },
      { name: 'Dmitri', trait: 'å®¶æ—é€£ã‚Œ(3äºº)', effect: { population: 3, resources: -5, crime: 1, happiness: 2, diversity: 1 } },

      // ãƒªã‚¹ã‚¯ç³»
      { name: 'Doro', trait: 'å…ƒå…µå£«', effect: { population: 1, resources: 2, crime: 5, happiness: -3, diversity: 1 } },
      { name: 'Viktor', trait: 'å‰ç§‘è€…', effect: { population: 1, resources: 1, crime: 8, happiness: -5, diversity: 0 } },
      { name: 'Sergei', trait: 'å¯†è¼¸æ¥­è€…', effect: { population: 1, resources: 5, crime: 10, happiness: -4, diversity: 0 } },
      { name: 'Zeen', trait: 'æ”¿æ²»æ´»å‹•å®¶', effect: { population: 1, resources: -2, crime: 3, happiness: -2, diversity: 7 } },

      // é«˜é½¢è€…ãƒ»å¼±è€…
      { name: 'Elsa', trait: 'é«˜é½¢å¥³æ€§', effect: { population: 1, resources: -5, crime: 0, happiness: 1, diversity: 1 } },
      { name: 'Georg', trait: 'é«˜é½¢ç”·æ€§', effect: { population: 1, resources: -4, crime: 0, happiness: 1, diversity: 1 } },
      { name: 'Nina', trait: 'éšœãŒã„è€…', effect: { population: 1, resources: -6, crime: 0, happiness: 2, diversity: 2 } },

      // ç‰¹æ®Šè·
      { name: 'Hiro', trait: 'AIç ”ç©¶è€…', effect: { population: 1, resources: 12, crime: 0, happiness: 2, diversity: 3 } },
      { name: 'Greta', trait: 'ç’°å¢ƒæ´»å‹•å®¶', effect: { population: 1, resources: -3, crime: 1, happiness: 3, diversity: 8 } },
      { name: 'Leo', trait: 'ã‚¸ãƒ£ãƒ¼ãƒŠãƒªã‚¹ãƒˆ', effect: { population: 1, resources: 0, crime: 2, happiness: 1, diversity: 6 } },
    ];

    // 100äººä»¥ä¸Šã«ãªã‚‹ã‚ˆã†è¤‡è£½ãƒ»ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
    const generateMigrants = () => {
      const migrants = [];
      for (let i = 0; i < 120; i++) {
        const base = MIGRANT_TYPES[i % MIGRANT_TYPES.length];
        migrants.push({
          ...base,
          id: i,
          name: base.name + (i >= MIGRANT_TYPES.length ? ` ${Math.floor(i / MIGRANT_TYPES.length) + 1}` : '')
        });
      }
      return migrants;
    };

    const MIGRANTS_DATA = generateMigrants();

    // ============ ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒ¼ãƒˆ ============
    const state = {
      population: 100,
      resources: 100,
      happiness: 70,
      diversity: 30,
      crime: 10,
      accepted: 0
    };

    // ============ Canvasè¨­å®š ============
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;

    // ============ æ¼‚æµè€…ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ============
    class Migrant {
      constructor(data) {
        this.data = data;
        this.x = Math.random() * 100 + 20;
        this.y = Math.random() * H;
        this.vx = Math.random() * 0.5 + 0.3;
        this.vy = (Math.random() - 0.5) * 0.2;
        this.r = 6;
        this.color = this.getColor();
        this.selected = false;
      }

      getColor() {
        if (this.data.effect.crime >= 8) return '#e53935'; // å±é™º
        if (this.data.effect.crime >= 5) return '#fb8c00'; // ã‚„ã‚„å±é™º
        if (this.data.effect.resources >= 8) return '#43a047'; // é«˜æŠ€èƒ½
        if (this.data.effect.resources <= -5) return '#5e35b1'; // å¼±è€…
        return '#1e88e5'; // é€šå¸¸
      }

      update(migrants) {
        // å›½å¢ƒä»˜è¿‘ã§ã®æ¸›é€Ÿã¨æ»ç•™
        const atBorder = this.x >= W - 200;

        // ç¾¤ä½“é‹å‹•ï¼šè¿‘ãã®æ¼‚æµè€…ã¨ã®åç™ºãƒ»æ•´åˆ—
        let pushX = 0, pushY = 0;
        let count = 0;

        for (let other of migrants) {
          if (other === this) continue;
          const dx = this.x - other.x;
          const dy = this.y - other.y;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < 30 && dist > 0) {
            pushX += dx / dist;
            pushY += dy / dist;
            count++;
          }
        }

        if (count > 0) {
          this.vx += pushX * 0.01;
          this.vy += pushY * 0.01;
        }

        // ãƒ©ãƒ³ãƒ€ãƒ ãƒã‚¤ã‚º
        this.vx += (Math.random() - 0.5) * 0.05;
        this.vy += (Math.random() - 0.5) * 0.05;

        // å›½å¢ƒä»˜è¿‘ã§å¤§å¹…æ¸›é€Ÿ
        if (atBorder) {
          this.vx *= 0.95;
          this.vy *= 0.95;
          // æ»ç•™æ™‚ã®ãƒ©ãƒ³ãƒ€ãƒ ç§»å‹•
          this.vx += (Math.random() - 0.5) * 0.1;
          this.vy += (Math.random() - 0.5) * 0.1;
        }

        // é€Ÿåº¦åˆ¶é™
        const maxSpeed = atBorder ? 0.5 : 2;
        const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
        if (speed > maxSpeed) {
          this.vx = (this.vx / speed) * maxSpeed;
          this.vy = (this.vy / speed) * maxSpeed;
        }

        // ä½ç½®æ›´æ–°
        this.x += this.vx;
        this.y += this.vy;

        // å›½å¢ƒã®å£ã§åœæ­¢
        if (this.x > W - 110) {
          this.x = W - 110;
          this.vx = 0;
        }

        // å¢ƒç•Œåå°„
        if (this.y < this.r || this.y > H - this.r) {
          this.vy *= -0.8;
          this.y = Math.max(this.r, Math.min(H - this.r, this.y));
        }
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();

        // ãƒ›ãƒãƒ¼æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 1;
        ctx.stroke();

        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤º
        const effects = [];
        const e = this.data.effect;
        if (e.population && e.population !== 0) effects.push(`äººå£${e.population > 0 ? '+' : ''}${e.population}`);
        if (e.resources && e.resources !== 0) effects.push(`è³‡æº${e.resources > 0 ? '+' : ''}${e.resources}`);
        if (e.happiness && e.happiness !== 0) effects.push(`å¹¸ç¦${e.happiness > 0 ? '+' : ''}${e.happiness}`);
        if (e.crime && e.crime !== 0) effects.push(`çŠ¯ç½ª${e.crime > 0 ? '+' : ''}${e.crime}`);

        // åå‰ã¨è·æ¥­
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 11px sans-serif';
        ctx.fillText(this.data.name, this.x + 10, this.y - 8);

        ctx.fillStyle = '#64b5f6';
        ctx.font = '10px sans-serif';
        ctx.fillText(this.data.trait, this.x + 10, this.y + 3);

        // åŠ¹æœ
        ctx.fillStyle = '#ffa726';
        ctx.font = '9px sans-serif';
        ctx.fillText(effects.join(' '), this.x + 10, this.y + 13);
      }

      isAtBorder() {
        return this.x >= W - 150;
      }

      containsPoint(px, py) {
        const dx = this.x - px;
        const dy = this.y - py;
        return Math.sqrt(dx * dx + dy * dy) <= this.r + 5;
      }
    }

    // ============ ã‚²ãƒ¼ãƒ ç®¡ç† ============
    let migrants = [];
    let migrantQueue = [];
    let spawnTimer = 0;
    let gameOver = false;
    let gameTimeLeft = 30 * 60; // 30ç§’ = 1800ãƒ•ãƒ¬ãƒ¼ãƒ  (60fpsæƒ³å®š)

    function spawnMigrant() {
      if (migrantQueue.length > 0) {
        const data = migrantQueue.shift();
        migrants.push(new Migrant(data));
      }
    }

    function acceptMigrant(migrant) {
      if (!migrant) return;

      const data = migrant.data;
      for (let key in data.effect) {
        state[key] = Math.max(0, Math.min(200, state[key] + data.effect[key]));
      }
      state.accepted++;

      migrants = migrants.filter(m => m !== migrant);
      updateUI();
      checkGameOver();
    }

    function updateUI() {
      const atBorderCount = migrants.filter(m => m.isAtBorder()).length;

      document.getElementById('population').textContent = state.population;
      document.getElementById('resources').textContent = state.resources;
      document.getElementById('happiness').textContent = state.happiness;
      document.getElementById('diversity').textContent = state.diversity;
      document.getElementById('crime').textContent = state.crime;
      document.getElementById('accepted').textContent = state.accepted;
      document.getElementById('atBorder').textContent = atBorderCount;
      document.getElementById('queue-count').textContent = `å¾…æ©Ÿä¸­: ${migrantQueue.length}äºº | å›½å¢ƒä»˜è¿‘: ${migrants.length}äºº`;

      // å±æ©Ÿè¡¨ç¤º
      ['resources', 'happiness'].forEach(key => {
        const el = document.getElementById(key);
        if (state[key] < 20) el.classList.add('critical');
        else if (state[key] > 80) el.classList.add('good');
        else el.classList.remove('critical', 'good');
      });

      if (state.crime > 50) {
        document.getElementById('crime').classList.add('critical');
      } else {
        document.getElementById('crime').classList.remove('critical');
      }

      // å›½å¢ƒæ»ç•™ã®è­¦å‘Šè¡¨ç¤º
      const atBorderEl = document.getElementById('atBorder');
      if (atBorderCount > 20) {
        atBorderEl.classList.add('critical');
      } else if (atBorderCount > 10) {
        atBorderEl.style.background = '#fb8c00';
      } else {
        atBorderEl.classList.remove('critical');
        atBorderEl.style.background = '';
      }
    }

    function checkGameOver() {
      if (state.resources <= 0 || state.happiness <= 0 || state.crime >= 100) {
        gameOver = true;
        showGameOver();
      }
    }

    function showGameOver() {
      const reason = state.resources <= 0 ? 'è³‡æºæ¯æ¸‡' :
                     state.happiness <= 0 ? 'ç¤¾ä¼šå´©å£Š' :
                     state.crime >= 100 ? 'æ²»å®‰å´©å£Š' : 'ä¸æ˜';

      const div = document.createElement('div');
      div.className = 'game-over';
      div.innerHTML = `
        <h2>ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼</h2>
        <p>åŸå› : ${reason}</p>
        <p>å—å…¥äººæ•°: ${state.accepted}äºº</p>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px;">å†ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      `;
      document.body.appendChild(div);
    }

    function showTimeUpResult() {
      // ã‚¹ã‚³ã‚¢è¨ˆç®—
      const score = state.accepted * 100 + state.population + state.resources + state.happiness + state.diversity - state.crime;

      let rank = 'E';
      if (score >= 1000) rank = 'S';
      else if (score >= 800) rank = 'A';
      else if (score >= 600) rank = 'B';
      else if (score >= 400) rank = 'C';
      else if (score >= 200) rank = 'D';

      const div = document.createElement('div');
      div.className = 'game-over';
      div.innerHTML = `
        <h2>ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼</h2>
        <p style="font-size: 24px; margin: 20px 0;">ãƒ©ãƒ³ã‚¯: <span style="color: #ffd700; font-size: 36px;">${rank}</span></p>
        <p>å—å…¥äººæ•°: ${state.accepted}äºº</p>
        <p>æœ€çµ‚ã‚¹ã‚³ã‚¢: ${score}ç‚¹</p>
        <hr style="margin: 20px 0; border-color: #444;">
        <p>äººå£: ${state.population} | è³‡æº: ${state.resources}</p>
        <p>å¹¸ç¦åº¦: ${state.happiness} | å¤šæ§˜æ€§: ${state.diversity}</p>
        <p>çŠ¯ç½ªç‡: ${state.crime}</p>
        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #2e7d32; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>
      `;
      document.body.appendChild(div);
    }

    // ============ æç”»ãƒ«ãƒ¼ãƒ— ============
    function draw() {
      // èƒŒæ™¯ï¼ˆæµ·â†’å›½å¢ƒï¼‰
      ctx.clearRect(0, 0, W, H);

      // æµ·
      const gradient = ctx.createLinearGradient(0, 0, W, 0);
      gradient.addColorStop(0, '#1e3a5f');
      gradient.addColorStop(0.4, '#2a5298');
      gradient.addColorStop(0.7, '#3d3d3d');
      gradient.addColorStop(1, '#2d2d2d');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, W, H);

      // å›½å¢ƒå£
      ctx.fillStyle = '#555';
      ctx.fillRect(W - 100, 0, 100, H);

      ctx.fillStyle = '#ff6b6b';
      ctx.font = 'bold 20px sans-serif';
      ctx.fillText('å›½å¢ƒ', W - 70, H / 2);

      // ã‚²ãƒ¼ãƒˆ
      ctx.strokeStyle = '#ffd700';
      ctx.lineWidth = 3;
      ctx.strokeRect(W - 90, H / 2 - 50, 80, 100);

      // æ¼‚æµè€…æç”»
      migrants.forEach(m => m.draw());
    }

    function update() {
      if (gameOver) return;

      // ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒãƒ¼æ›´æ–°
      gameTimeLeft--;
      const secondsLeft = Math.ceil(gameTimeLeft / 60);
      document.getElementById('timer-display').textContent = secondsLeft;

      // æ®‹ã‚Š10ç§’ã§è­¦å‘Š
      const timerEl = document.getElementById('game-timer');
      if (secondsLeft <= 10) {
        timerEl.classList.add('warning');
      }

      // æ™‚é–“åˆ‡ã‚Œ
      if (gameTimeLeft <= 0) {
        gameOver = true;
        showTimeUpResult();
        return;
      }

      // ã‚¹ãƒãƒ¼ãƒ³
      spawnTimer++;
      if (spawnTimer > 90 && migrantQueue.length > 0) {
        spawnMigrant();
        spawnTimer = 0;
      }

      // æ¼‚æµè€…æ›´æ–°
      migrants.forEach(m => m.update(migrants));

      updateUI();
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    // ============ ã‚¤ãƒ™ãƒ³ãƒˆ ============
    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // ã‚¯ãƒªãƒƒã‚¯ã—ãŸä½ç½®ã®æ¼‚æµè€…ã‚’æ¢ã™
      for (let migrant of migrants) {
        if (migrant.containsPoint(x, y)) {
          acceptMigrant(migrant);
          break;
        }
      }
    });

    // ============ åˆæœŸåŒ– ============
    migrantQueue = [...MIGRANTS_DATA];
    updateUI();
    gameLoop();
  </script>
</body>
</html>
