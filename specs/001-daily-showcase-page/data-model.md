# Data Model: Daily Challenge Showcase

**Feature**: Daily Challenge Showcase Page
**Date**: 2025-10-18

## Overview

This document defines the data structures and relationships for the daily challenge showcase system. The system uses a file-based approach with a generated manifest for metadata aggregation.

## Entities

### 1. Daily Challenge

Represents a single day's coding challenge.

**Storage**: File system (`dayN/` folder structure)

**Attributes**:

| Attribute | Type | Required | Description | Example |
|-----------|------|----------|-------------|---------|
| `number` | Integer | Yes | Sequential day number starting from 1 | `1`, `2`, `365` |
| `folder` | String | Yes | Directory name containing the challenge | `"day1"`, `"day2"` |
| `url` | String | Yes | Relative URL path to the challenge | `"day1/"` |
| `title` | String | Yes | Challenge title extracted from HTML `<title>` | `"Falling Stack – Explosive Compression"` |
| `theme` | String | No | Challenge theme if specified in HTML | `"圧縮"` (compression) |
| `created` | ISO 8601 DateTime | No | Folder creation timestamp | `"2025-10-18T09:13:00.000Z"` |

**File Structure**:
```
dayN/
├── index.html    # Required: Main challenge page
└── assets/       # Optional: Images, scripts, styles
```

**Constraints**:
- Folder name MUST match pattern `/^day\d+$/` (e.g., `day1`, `day42`, `day365`)
- Folder MUST contain `index.html` file
- Day numbers SHOULD be sequential but gaps are allowed (e.g., day1, day2, day5 is valid)
- Multiple challenges cannot share the same day number

---

### 2. Manifest

Aggregated metadata for all challenges, generated automatically.

**Storage**: `manifest.json` at repository root

**Attributes**:

| Attribute | Type | Required | Description | Example |
|-----------|------|----------|-------------|---------|
| `updated` | ISO 8601 DateTime | Yes | Timestamp of last manifest generation | `"2025-10-18T10:20:00.000Z"` |
| `total` | Integer | Yes | Total number of discovered challenges | `2`, `365` |
| `days` | Array<DailyChallenge> | Yes | Array of all daily challenges | See below |

**Structure**:

```json
{
  "updated": "2025-10-18T10:20:00.000Z",
  "total": 2,
  "days": [
    {
      "number": 1,
      "folder": "day1",
      "url": "day1/",
      "title": "Falling Stack – Explosive Compression",
      "theme": "圧縮",
      "created": "2025-10-18T09:13:00.000Z"
    },
    {
      "number": 2,
      "folder": "day2",
      "url": "day2/",
      "title": "Day 2",
      "created": "2025-10-18T09:11:00.000Z"
    }
  ]
}
```

**Generation**:
- Automatically generated by pre-commit git hook
- Scans repository root for `dayN/` folders
- Parses each `index.html` for metadata
- Sorts challenges by day number (ascending)

**Constraints**:
- File MUST be valid JSON
- `days` array MUST be sorted by `number` in ascending order
- `total` MUST equal `days.length`
- File size should remain reasonable (<100KB for 365 entries)

---

### 3. Showcase Page

The main index page that displays all challenges.

**Storage**: `index.html` at repository root

**Rendered Structure** (DOM):

```html
<div class="showcase-container">
  <header class="showcase-header">
    <h1>AI Sprint Challenge</h1>
    <p class="challenge-count"><!-- Total from manifest --></p>
  </header>

  <div class="showcase-grid">
    <!-- For each challenge in manifest.days (reverse order) -->
    <article class="challenge-card" data-day="N">
      <div class="challenge-header">
        <h2>Day N: <span class="title"><!-- From manifest --></span></h2>
        <p class="theme"><!-- From manifest --></p>
        <time datetime="ISO-8601"><!-- From manifest --></time>
      </div>

      <div class="iframe-container">
        <iframe
          data-src="dayN/"
          src="about:blank"
          loading="lazy"
          sandbox="allow-scripts allow-same-origin"
        ></iframe>
      </div>

      <a href="dayN/" class="view-full">View Full Page →</a>
    </article>
  </div>
</div>
```

**State Management**:

| State | Type | Description |
|-------|------|-------------|
| `loadedManifest` | Object | Cached manifest data |
| `renderedIframes` | Set<number> | Day numbers with currently rendered iframes |
| `intersectionObserver` | IntersectionObserver | Lazy loading controller |

---

## Relationships

```
Repository (1) ──> (N) Daily Challenge
                    │
                    │ folder structure
                    ├── day1/index.html
                    ├── day2/index.html
                    └── dayN/index.html

Pre-commit Hook ──> Scans Folders ──> Generates Manifest (1)
                                            │
                                            │ describes
                                            ↓
                                    Daily Challenges (N)

Showcase Page ──> Loads Manifest (1) ──> Renders Challenges (N)
                                            │
                                            │ embeds via iframe
                                            ↓
                                    Day Index.html (N)
```

---

## Data Flow

### 1. Adding a New Challenge (User Workflow)

```
User creates folder
    ↓
dayN/index.html
    ↓
git add dayN/
    ↓
git commit  ──────> Pre-commit hook runs
                        ↓
                   Scans for dayN/ folders
                        ↓
                   Parses each index.html
                        ↓
                   Updates manifest.json
                        ↓
                   git add manifest.json
    ↓
git push
    ↓
GitHub Pages deploys
    ↓
Showcase page loads updated manifest
    ↓
New challenge appears automatically
```

### 2. Viewing Showcase (Visitor Workflow)

```
Visitor opens index.html
    ↓
fetch('manifest.json')
    ↓
Parse JSON
    ↓
Render challenge cards (newest first)
    ↓
Intersection Observer monitors scroll
    ↓
Card enters viewport?
    ├── YES: Load iframe (data-src → src)
    └── NO:  Keep as placeholder
    ↓
Iframe loads dayN/index.html
    ↓
Challenge renders with full interactivity
```

---

## Validation Rules

### Daily Challenge Folder

- ✅ MUST match regex: `/^day\d+$/`
- ✅ MUST contain `index.html` file
- ✅ Day number MUST be positive integer
- ⚠️ SHOULD have sequential day numbers (gaps allowed)
- ❌ MUST NOT have duplicate day numbers

### Manifest.json

- ✅ MUST be valid JSON
- ✅ `updated` MUST be valid ISO 8601 datetime
- ✅ `total` MUST equal `days.length`
- ✅ `days` array MUST be sorted by `number` ascending
- ✅ Each day MUST have required fields: `number`, `folder`, `url`, `title`
- ⚠️ Day numbers in manifest SHOULD match existing folders

### Index.html (Challenge Page)

- ✅ MUST be valid HTML5
- ✅ SHOULD have `<title>` tag (for metadata extraction)
- ⚠️ MAY have theme marker (e.g., `<h2>テーマ：[THEME]</h2>`)
- ⚠️ SHOULD be self-contained (avoid dependencies on parent page)

---

## Performance Considerations

### Manifest Size

| Challenges | Manifest Size | Load Time (est.) |
|------------|---------------|------------------|
| 10 | ~2 KB | <50ms |
| 100 | ~15 KB | <100ms |
| 365 | ~50 KB | <200ms |
| 1000 | ~140 KB | <500ms |

**Optimization**: Manifest is cached by browser, only fetched once per visit.

### Iframe Memory

| Rendered Iframes | Memory Usage (est.) | Performance |
|------------------|---------------------|-------------|
| 5 | ~75 MB | Excellent |
| 10 | ~150 MB | Good |
| 20 | ~300 MB | Acceptable |
| 50+ | ~750+ MB | Poor - avoid |

**Optimization**: Virtual scrolling limits rendered iframes to 15-20 maximum.

---

## Extension Points

Future enhancements to the data model:

### 1. Tags/Categories

```json
{
  "number": 1,
  "title": "...",
  "tags": ["physics", "matter.js", "animation"]
}
```

### 2. Difficulty Level

```json
{
  "number": 1,
  "title": "...",
  "difficulty": "intermediate",
  "timeSpent": "15min"
}
```

### 3. Code Statistics

```json
{
  "number": 1,
  "title": "...",
  "stats": {
    "linesOfCode": 142,
    "technologies": ["HTML", "CSS", "JavaScript", "Matter.js"]
  }
}
```

### 4. Social Metadata

```json
{
  "number": 1,
  "title": "...",
  "socialImage": "day1/og-image.png",
  "description": "Interactive physics simulation..."
}
```

These extensions can be added without breaking existing implementations.

---

## Summary

**Core Entities**:
1. **Daily Challenge**: File-based (dayN/index.html)
2. **Manifest**: Generated JSON aggregating all challenges
3. **Showcase Page**: HTML page consuming manifest

**Key Design Decisions**:
- File-based storage (no database)
- Automatic manifest generation (no manual updates)
- Lazy iframe loading (performance)
- Extensible JSON schema (future-proof)

**Validation**: Enforced at generation time (pre-commit hook) and runtime (showcase page)
